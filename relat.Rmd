---
title: "O GRANDE TÍTULO"
author: "Alisson Rosa"
abstract: "Aqui você escreve o resumo"
header-includes:
   - \usepackage[brazil]{babel}
   - \usepackage{bm}
geometry: margin=2cm
output:
  bookdown::pdf_document2:
editor_options:
  chunk_output_type: console
---



```{r setup,include=F}

options(digits=3)  #Arrendodamento
options(scipen=999)
ggplot2::theme_set(ggplot2::theme_minimal()) #Tema dos gráficos produzidos no ggplot2
knitr::opts_chunk$set(echo=F,message=F,warning=F,fig.pos = 'H',fig.align = 'center',fig.width=7.8, fig.height=3.85)
library(tidyverse)
df=read_csv("naruto.csv")
```

```{r functions}
barplot=function(df,v){
ggplot(df, aes(x = {{v}}, 
                          y = prop.table(stat(count)), 
                            fill = {{v}}, 
                          label = scales::percent(prop.table(stat(count))))) +
    geom_bar(position = "dodge",color="black") + 
    geom_text(stat = 'count',
              position = position_dodge(.9), 
              vjust = -0.5, 
              size = 3.5) + 
    scale_y_continuous(labels = scales::percent) + 
    labs(y="Proporção",x=df %>%
         select({{v}}) %>% 
         names(),caption = "Fonte: Elaborado pelos autores")+
    theme(plot.title = element_text(hjust=0.5,size=10),legend.position="none")
}

scale_fill_alisson <- function(...) {
  ggplot2:::manual_scale(
    "fill",
    values = setNames(
      c("#EA2129", "#F78D69", "#74BDCB"), levels(as.factor(df$Tipo)),
      ...
    )
  )
}
scale_fill_discrete <- \(...) scale_fill_alisson(...)
```

# Introdução
Naruto é uma animação japonesa (anime)  que adapta a  série de mangá escrita e ilustrada por Masashi Kishimoto, que conta a história de Naruto Uzumaki, um jovem ninja que constantemente procura por reconhecimento e sonha em se tornar Hokage, o ninja líder de sua vila. A história é dividida em duas partes, a primeira parte se passa nos anos da pré-adolescência de Naruto (clássico), e a segunda parte se passa em sua adolescência (Shippuden). Nesse trabalho trataremos sobre o Naruto Shippuden, desenvolvendo-o em uma perpestiva de séries temporais, a variável a ser estudada será a avaliação dos episódios, assim veremos  pontos importantes da saga ao longo do tempo.  
O Banco de dados utilizado é totalmente original, foi criado fazendo *Web scraping* de dois sites, sendo eles o [ratingraph](https://www.ratingraph.com/tv-shows/naruto-shippden-ratings-27282/) e o [animefillerlist](https://www.animefillerlist.com/shows/naruto-shippuden).


# Informações
```{r }
df=read_csv("naruto.csv")
  
```
Como o anime é uma adaptação, existem  episódios originais do próprio anime, em outras palavras não seguem o material original, esses episódios são chamados de Fillers, existem também episódios que seguem a trama do mangá mas também possuem elementos novos, esses chamados de Mixed Canon.  
Vejamos pelo gráfico a seguir a porcentagem do tipo dos episódios

```{r plttipo}
barplot(df,Tipo)
```
É um fato bastante curioso, Naruto Shippuden possui uma quantidade altíssima de episódios fillers, aproximadamente 41%, note pela tabela  que são somente 31 episódios a mais canônicos.
```{r}
df %>% 
  group_by(Tipo) %>% 
  count() %>% 
  rename(Quantidade=n) %>% 
  mypdf1::pdf1_tbl("Valores Absolutos do Tipo de Episódio")
```

Em termos de avaliação ao longo do tempo, podemos utilizar como indíce ordinal o próprio número do episódio já que que é uma função injetora no tempo.

```{r}
df %>% 
  ggplot(aes(x=numero_episodio,y=rate)) +
  geom_line()+
  labs(x="Numero do episódio",y="Avaliação")
```
Há bastante coisa a se notar nesse gráfico, primeiramente pelos episódios 200 e 400, existe um indicio de alteração na média das variáveis aleatórias, portanto furando o pressuposto de média constante ao longo do tempo, perto dos episódios finais da saga nota-se  também inúmeras quedas bruscas na avaliação sem um contra-peso de avaliações com notas altas, outro indicio de não estacionariedade.  
É importante tentarmos entender um pouco sobre esses episódios com notas baixas, assim vamos ver esse gráfico pelo tipo de episódio.

```{r}
df %>% 
  ggplot(aes(x=numero_episodio,y=rate,color=Tipo,group=1)) +
  geom_line()+
  labs(x="Numero do episódio",y="Avaliação")+
  ggplot2::scale_color_manual(breaks = c(levels(as.factor(df$Tipo))), values = c("#EA2129", "#F78D69", "#74BDCB"))
```
Assim fica fácil ver que os episódios com menor avaliação são em sua maior parte fillers, toda queda brusca de avaliação tem um episódio filler envolvido.


# Testes
É necessário avaliar se o que vimos na seção anterior vale de fato para o processo estocástico, assim vamos precisar aplicar testes de hipóteses para verificar algumas propriedades, como existência de tendência e  sazonalidade.

### Tendência 

### Sazonalidade
# Modelagem


# Tabelas e resultados MYPDF1 ENTROU NO CHAT
# Referências


```{r }
t=df %>% 
  ggplot(aes(numero_episodio,rate))+
  geom_line(size=0.8,color="#050A03")+
  theme_void()+
  labs("Série")
t %>% 
ggimage::ggbackground(background="https://www.ixpap.com/images/2021/03/desktop-naruto-wallpaper-ixpap.jpg")    
```


```{r }
df %>% 
  group_by(Saga) %>% 
  summarise(mean=mean(rate)) %>% 
  arrange(desc(mean))
```

```{r}



```


